<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core">

<h:head>
    <title>Directorio de Autores</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .card {
            margin-bottom: 2rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        }
        .card-header {
            background-color: #0d6efd;
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.25rem;
        }
        .form-table {
            width: 100%;
        }
        .form-table td {
            padding: 8px;
            vertical-align: middle;
        }
        .form-table td:first-child {
            width: 25%;
            font-weight: 500;
        }
        .validation-box {
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            padding: 1rem;
            min-height: 80px;
            background-color: #fff;
            margin-top: 1rem;
        }
        .dataTable {
            width: 100%;
            margin-top: 1rem;
        }
        .dataTable th {
            background-color: #e9ecef;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            font-weight: 600;
        }
        .dataTable td {
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            vertical-align: middle;
        }
        .btn-operations {
            margin-right: 5px;
        }
        .filter-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 0.25rem;
        }
        .count-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 0.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</h:head>

<h:body>
    <div class="container-fluid">
        <h2 class="text-center mb-4">Directorio de Autores</h2>

        <h:form id="mainForm">
            <!-- FORMULARIO DE AUTORES -->
            <div class="card">
                <div class="card-header">FORMULARIO DE AUTORES</div>
                <div class="card-body">
                    <table class="form-table">
                        <tr>
                            <td><h:outputLabel for="nombre" value="Nombre:"/></td>
                            <td>
                                <h:inputText id="nombre"
                                             value="#{authorBean.author.firstName}"
                                             styleClass="form-control"
                                             required="true"
                                             requiredMessage="El nombre es obligatorio."/>
                            </td>
                        </tr>
                        <tr>
                            <td><h:outputLabel for="apellido" value="Apellido:"/></td>
                            <td>
                                <h:inputText id="apellido"
                                             value="#{authorBean.author.lastName}"
                                             styleClass="form-control"
                                             required="true"
                                             requiredMessage="El apellido es obligatorio."/>
                            </td>
                        </tr>
                        <tr>
                            <td><h:outputLabel for="fechaNacimiento" value="Fecha de Nacimiento:"/></td>
                            <td>
                                <h:inputText id="fechaNacimiento"
                                             type="date"
                                             value="#{authorBean.author.birthDate}"
                                             styleClass="form-control"
                                             required="true"
                                             requiredMessage="La fecha de nacimiento es obligatoria.">
                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                </h:inputText>
                            </td>
                        </tr>
                        <tr>
                            <td><h:outputLabel for="telefono" value="Teléfono:"/></td>
                            <td>
                                <h:inputText id="telefono"
                                             value="#{authorBean.author.phone}"
                                             styleClass="form-control"
                                             placeholder="####-####">
                                    <f:validator validatorId="svPhoneValidator"/>
                                </h:inputText>
                            </td>
                        </tr>
                        <tr>
                            <td><h:outputLabel for="genero" value="Género Literario:"/></td>
                            <td>
                                <h:selectOneMenu id="genero"
                                                 value="#{literaryGenreBean.selectedGenreId}"
                                                 styleClass="form-select"
                                                 required="true"
                                                 requiredMessage="Debe seleccionar un género.">
                                    <f:selectItem itemLabel="-- Seleccione un género --"
                                                  itemValue="#{null}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{literaryGenreBean.genres}"
                                                   var="g"
                                                   itemValue="#{g.id}"
                                                   itemLabel="#{g.name}"/>
                                </h:selectOneMenu>
                            </td>
                        </tr>
                    </table>

                    <div class="mt-3">
                        <h:commandButton value="#{authorBean.author.id == null ? 'AGREGAR' : 'ACTUALIZAR'}"
                                         action="#{authorBean.addAuthor()}"
                                         styleClass="btn btn-primary">
                            <f:ajax execute="@form" render="@form authorTable countGroup"/>
                        </h:commandButton>
                    </div>

                    <div class="validation-box">
                        <h:outputLabel value="Validaciones:" styleClass="fw-bold d-block mb-2"/>
                        <h:messages styleClass="text-danger" globalOnly="true"/>
                        <h:outputText value="#{authorBean.message}"
                                      styleClass="text-success fw-bold"
                                      rendered="#{not empty authorBean.message}"/>
                    </div>
                </div>
            </div>

            <!-- DIRECTORIO DE AUTORES -->
            <div class="card">
                <div class="card-header">DIRECTORIO DE AUTORES</div>
                <div class="card-body">
                    <!-- Filtro por género -->
                    <div class="filter-section">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                <h:outputLabel for="genreFilter" value="Filtrar por Género:" styleClass="form-label mb-0"/>
                            </div>
                            <div class="col-auto">
                                <h:selectOneMenu id="genreFilter"
                                                 value="#{authorBean.selectedGenreFilterId}"
                                                 styleClass="form-select">
                                    <f:selectItem itemLabel="Todos" itemValue="#{null}"/>
                                    <f:selectItems value="#{literaryGenreBean.genres}"
                                                   var="g"
                                                   itemValue="#{g.id}"
                                                   itemLabel="#{g.name}"/>
                                    <f:ajax listener="#{authorBean.applyGenreFilter()}"
                                            render="authorTable countGroup"/>
                                </h:selectOneMenu>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de autores -->
                    <h:dataTable id="authorTable"
                                 value="#{authorBean.filteredAuthors}"
                                 var="auth"
                                 styleClass="dataTable table-hover"
                                 headerClass="table-header"
                                 rowClasses="table-row">

                        <h:column>
                            <f:facet name="header">ID</f:facet>
                            <h:outputText value="#{auth.id}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Nombre</f:facet>
                            <h:outputText value="#{auth.firstName}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Apellido</f:facet>
                            <h:outputText value="#{auth.lastName}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Teléfono</f:facet>
                            <h:outputText value="#{auth.phone}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Nacimiento</f:facet>
                            <h:outputText value="#{auth.birthDate}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Género</f:facet>
                            <h:outputText value="#{auth.literaryGenre != null ? auth.literaryGenre.name : 'Sin género'}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Operaciones</f:facet>
                            <h:commandButton value="EDITAR"
                                             action="#{authorBean.editAuthor(auth)}"
                                             styleClass="btn btn-sm btn-warning btn-operations">
                                <f:ajax execute="@this" render="@form"/>
                            </h:commandButton>
                            <h:commandButton value="BORRAR"
                                             action="#{authorBean.deleteAuthor(auth)}"
                                             styleClass="btn btn-sm btn-danger"
                                             onclick="return confirm('¿Está seguro de eliminar a este autor?');">
                                <f:ajax execute="@this" render="authorTable countGroup"/>
                            </h:commandButton>
                        </h:column>
                    </h:dataTable>

                    <!-- Sección de conteo -->
                    <div class="count-section">
                        <h:panelGroup id="countGroup" layout="block">
                            <strong>Número de autores: </strong>
                            <span class="badge bg-primary fs-6">#{authorBean.filteredAuthors.size()}</span>
                        </h:panelGroup>
                        <h:commandButton value="CONTAR" styleClass="btn btn-secondary">
                            <f:ajax render="countGroup"/>
                        </h:commandButton>
                    </div>
                </div>
            </div>
        </h:form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</h:body>

</html>
